<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Location Verification / Count</title>

  <!-- SheetJS -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.19.3/dist/xlsx.full.min.js"></script>

  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin: 0; background: #0b1220; color: #e8eefc; }
    .wrap { max-width: 980px; margin: 0 auto; padding: 18px; }
    .card { background: #121b2f; border: 1px solid #243253; border-radius: 14px; padding: 16px; margin: 12px 0; }
    h1 { margin: 8px 0 0; font-size: 22px; }
    .row { display:flex; gap:12px; flex-wrap: wrap; align-items: center; }
    label { font-size: 12px; opacity: .9; display:block; margin-bottom: 6px; }
    input, select, button { font-size: 16px; padding: 10px 12px; border-radius: 10px; border: 1px solid #2a3a63; background: #0d1730; color: #e8eefc; }
    button { cursor: pointer; background: #2b6cff; border-color: #2b6cff; }
    button.secondary { background: transparent; border-color: #2a3a63; }
    button.danger { background: #ff3b3b; border-color: #ff3b3b; }
    button:disabled { opacity:.45; cursor:not-allowed; }
    .big { font-size: 34px; font-weight: 900; letter-spacing: .3px; }
    .hint { opacity: .9; }
    .pill { display:inline-block; padding: 6px 10px; border-radius: 999px; border: 1px solid #2a3a63; background: #0d1730; font-size: 13px; }
    .ok { border-color:#2dd36f; color:#2dd36f; }
    .bad { border-color:#ff6464; color:#ff6464; }
    .muted { opacity: .75; }
    .divider { height:1px; background:#243253; margin: 12px 0; }
    .scanBox { border-radius: 14px; border: 2px dashed #36508a; padding: 14px; background: rgba(11,18,32,.5); user-select: none; }
    .scanBox.active { border-color: #2b6cff; box-shadow: 0 0 0 3px rgba(43,108,255,.25); }
    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .grid2 { display:grid; grid-template-columns: 1.35fr 1fr; gap: 12px; }
    @media (max-width: 820px) { .grid2 { grid-template-columns: 1fr; } .big { font-size: 28px; } }

    /* keypad modal */
    .modalBackdrop { position: fixed; inset:0; background: rgba(0,0,0,.55); display:none; align-items:center; justify-content:center; padding: 18px; }
    .modalBackdrop.show { display:flex; }
    .modal { width: min(420px, 100%); background:#121b2f; border:1px solid #243253; border-radius: 16px; padding: 14px; }
    .keypad { display:grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 10px; }
    .key { padding: 14px; border-radius: 14px; border:1px solid #2a3a63; background:#0d1730; font-size: 20px; font-weight: 800; color:#e8eefc; }
    .key.wide { grid-column: span 2; }
    .key.enter { background:#2dd36f; border-color:#2dd36f; color:#06110a; }
    .countDisplay { font-size: 36px; font-weight: 900; text-align:center; padding: 10px; border-radius: 12px; border:1px solid #2a3a63; background:#0d1730; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <h1>Location Verification / Count</h1>
      <div class="muted">Fast scan flow. Scans finalize on <span class="kbd">Enter</span>. Writes to Google Sheet in real time.</div>
    </div>

    <div class="card">
      <div class="row">
        <div style="flex:1; min-width:220px;">
          <label>Your name</label>
          <input id="employeeName" placeholder="Type your name" />
        </div>

        <div style="min-width:240px; flex:1;">
          <label>Mode</label>
          <select id="mode">
            <option value="verification">Location Verification</option>
            <option value="count">Count</option>
          </select>
        </div>
      </div>

      <div class="muted" style="margin-top:10px;">
        Apps Script endpoint is set in code: <span class="kbd" id="apiLabel"></span>
      </div>

      <div id="countSourceWrap" style="margin-top:14px; display:none;">
        <div class="row">
          <div style="min-width:260px;">
            <label>Count source</label>
            <select id="countSource">
              <option value="queue">Queue (auto from incorrect/empty)</option>
              <option value="upload">Upload file</option>
            </select>
          </div>
          <button id="loadQueueBtn" class="secondary">Load Queue</button>
        </div>
        <div class="muted" style="margin-top:8px;">
          Queue items loaded from <span class="kbd">?action=get_queue</span>.
        </div>
      </div>

      <div class="row" style="margin-top: 14px;">
        <div style="flex:1; min-width:280px;">
          <label>Upload Excel file (.xlsx)</label>
          <input id="fileInput" type="file" accept=".xlsx,.xls" />
          <div class="muted" style="margin-top:6px;">
            Needed for verification mode, and for count mode if you choose “Upload file”.
          </div>
        </div>

        <button id="startBtn">Start</button>
        <button id="submitBtn" class="secondary" disabled>Submit</button>
        <button id="resetBtn" class="danger">Reset</button>
      </div>

      <div class="divider"></div>
      <div class="hint">
        ✅ Speed flow: Scan location → scan UPC → next. Count mode adds calculator + submit.
      </div>
    </div>

    <div class="card">
      <div class="row" style="justify-content: space-between;">
        <div>
          <span class="pill" id="statusPill">Not started</span>
          <span class="pill muted" id="rowPill">Row: -</span>
        </div>
        <div class="pill muted">Focus: <span id="focusLabel">—</span></div>
      </div>

      <div class="divider"></div>

      <div class="grid2">
        <div class="scanBox" id="scanBox">
          <div class="muted" id="stepTitle">Step</div>
          <div class="big" id="bigPrompt">Upload file or load queue</div>
          <div class="divider"></div>
          <div class="muted">Expected</div>
          <div class="kbd" style="font-size:18px;" id="expectedText">—</div>
          <div style="height:10px;"></div>
          <div class="muted">Last scan</div>
          <div class="kbd" style="font-size:18px;" id="lastScanText">—</div>
          <div style="height:10px;"></div>
          <div class="muted">Scanner buffer</div>
          <div class="kbd" id="bufferText">—</div>
          <div style="margin-top:10px;" class="muted">
            (Click this box once if your device doesn’t capture scans automatically)
          </div>
        </div>

        <div class="card" style="margin:0;">
          <div class="muted">Progress</div>
          <div class="big"><span id="doneCount">0</span>/<span id="totalCount">0</span></div>
          <div class="divider"></div>
          <div class="row">
            <span class="pill ok">Correct: <b id="correctCount">0</b></span>
            <span class="pill bad">Incorrect: <b id="incorrectCount">0</b></span>
            <span class="pill muted">Empty: <b id="emptyCount">0</b></span>
          </div>
          <div class="divider"></div>
          <div class="muted">Count mode:</div>
          <div class="muted">After UPC scan, calculator opens → <span class="kbd">Enter</span> accepts → <span class="kbd">Submit</span> posts row.</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Count keypad modal -->
  <div class="modalBackdrop" id="modalBackdrop" aria-hidden="true">
    <div class="modal">
      <div class="muted" style="text-align:center;">Enter count</div>
      <div class="countDisplay kbd" id="countDisplay">0</div>
      <div class="keypad">
        <button class="key" data-k="1">1</button>
        <button class="key" data-k="2">2</button>
        <button class="key" data-k="3">3</button>
        <button class="key" data-k="4">4</button>
        <button class="key" data-k="5">5</button>
        <button class="key" data-k="6">6</button>
        <button class="key" data-k="7">7</button>
        <button class="key" data-k="8">8</button>
        <button class="key" data-k="9">9</button>
        <button class="key" data-k="del">⌫</button>
        <button class="key" data-k="0">0</button>
        <button class="key enter" data-k="enter">Enter</button>
        <button class="key wide" data-k="clear">Clear</button>
        <button class="key wide" data-k="cancel">Cancel</button>
      </div>
    </div>
  </div>

<script>
/** HARD-CODED APPS SCRIPT WEB APP URL **/
const API_URL = "https://script.google.com/macros/s/AKfycbylB5yoJrpLCf_AdPiYW2uJptcW-NADw0Zw_jw3Y7ENbxJLmoXTlnciQkeSCGqJo2MdkA/exec";

document.getElementById('apiLabel').textContent = API_URL;

const ui = {
  employeeName: document.getElementById('employeeName'),
  mode: document.getElementById('mode'),

  countSourceWrap: document.getElementById('countSourceWrap'),
  countSource: document.getElementById('countSource'),
  loadQueueBtn: document.getElementById('loadQueueBtn'),

  fileInput: document.getElementById('fileInput'),
  startBtn: document.getElementById('startBtn'),
  submitBtn: document.getElementById('submitBtn'),
  resetBtn: document.getElementById('resetBtn'),

  statusPill: document.getElementById('statusPill'),
  rowPill: document.getElementById('rowPill'),
  focusLabel: document.getElementById('focusLabel'),

  scanBox: document.getElementById('scanBox'),
  stepTitle: document.getElementById('stepTitle'),
  bigPrompt: document.getElementById('bigPrompt'),
  expectedText: document.getElementById('expectedText'),
  lastScanText: document.getElementById('lastScanText'),
  bufferText: document.getElementById('bufferText'),

  doneCount: document.getElementById('doneCount'),
  totalCount: document.getElementById('totalCount'),
  correctCount: document.getElementById('correctCount'),
  incorrectCount: document.getElementById('incorrectCount'),
  emptyCount: document.getElementById('emptyCount'),

  modalBackdrop: document.getElementById('modalBackdrop'),
  countDisplay: document.getElementById('countDisplay')
};

let rows = [];                 // AoA (first row is header)
let currentIdx = 0;            // 0-based index into data rows
let headerIdx = { loc:-1, upc:-1, expCount:-1 };
let step = 'upload';           // upload | location | upc | count | done
let scanBuffer = '';
let lastKeyTime = 0;
const SCAN_TIMEOUT_MS = 90;

const state = {
  started: false,
  mode: 'verification',          // verification | count
  employee: '',
  expectedLocation: '',
  expectedUPC: '',
  expectedCount: '',             // blind (from "Location On Hand")
  scannedLocation: '',
  scannedUPC: '',
  actualCount: null,             // count mode
  rowScanStart: null,
  counts: { done:0, correct:0, incorrect:0, empty:0 },
  lastPosted: null
};

function setPill(el, text, cls) {
  el.className = 'pill' + (cls ? ' ' + cls : '');
  el.textContent = text;
}

function normalizeLocation(s) {
  return String(s ?? '').trim().toUpperCase();
}

function normalizeUPC(s) {
  return String(s ?? '').replace(/\D/g,''); // digits only, preserves leading zeros
}

function beep(ok=true) {
  const ctx = new (window.AudioContext || window.webkitAudioContext)();
  const o = ctx.createOscillator();
  const g = ctx.createGain();
  o.type = 'sine';
  o.frequency.value = ok ? 880 : 220;
  g.gain.value = 0.08;
  o.connect(g); g.connect(ctx.destination);
  o.start();
  setTimeout(() => { o.stop(); ctx.close(); }, ok ? 90 : 140);
}

function setFocusLabel() {
  ui.focusLabel.textContent = step.toUpperCase();
}

function totalSteps() {
  return Math.max(0, rows.length - 1);
}

function setRowPill() {
  const total = totalSteps();
  const cur = Math.min(total, currentIdx + 1);
  ui.rowPill.textContent = total ? `Row: ${cur}/${total}` : 'Row: -';
}

function updateProgressUI() {
  ui.doneCount.textContent = state.counts.done;
  ui.totalCount.textContent = totalSteps();
  ui.correctCount.textContent = state.counts.correct;
  ui.incorrectCount.textContent = state.counts.incorrect;
  ui.emptyCount.textContent = state.counts.empty;
}

function setStep(next) {
  step = next;
  setFocusLabel();
  ui.submitBtn.disabled = true;

  if (step === 'upload') {
    setPill(ui.statusPill, 'Upload file or load queue', '');
    ui.stepTitle.textContent = 'Step';
    ui.bigPrompt.textContent = 'Upload file or load queue';
    ui.expectedText.textContent = '—';
    ui.lastScanText.textContent = '—';
  }
  if (step === 'location') {
    setPill(ui.statusPill, 'Scan LOCATION', '');
    ui.stepTitle.textContent = 'Go to location';
    ui.bigPrompt.textContent = 'SCAN LOCATION';
    ui.expectedText.textContent = state.expectedLocation || '—';
  }
  if (step === 'upc') {
    setPill(ui.statusPill, 'Scan UPC', '');
    ui.stepTitle.textContent = 'Grab item & scan';
    ui.bigPrompt.textContent = 'SCAN UPC';
    ui.expectedText.textContent = state.expectedUPC || '—';
  }
  if (step === 'count') {
    setPill(ui.statusPill, 'Enter COUNT', '');
    ui.stepTitle.textContent = 'Blind count';
    ui.bigPrompt.textContent = 'ENTER COUNT';
    ui.expectedText.textContent = '(expected hidden)';
  }
  if (step === 'done') {
    setPill(ui.statusPill, 'Complete ✅', 'ok');
    ui.stepTitle.textContent = 'Done';
    ui.bigPrompt.textContent = 'All steps complete ✅';
    ui.expectedText.textContent = '—';
  }
}

function pickHeaderIndex(headerRow, candidates) {
  const norm = (s) => String(s || '').trim().toLowerCase();
  const map = new Map(headerRow.map((h, i) => [norm(h), i]));
  for (const c of candidates) {
    const idx = map.get(norm(c));
    if (idx != null) return idx;
  }
  return -1;
}

function initHeaderIndexes() {
  const headerRow = rows[0] || [];
  headerIdx.loc = pickHeaderIndex(headerRow, ['Location']);
  headerIdx.upc = pickHeaderIndex(headerRow, ['upc', 'Expected UPC', 'UPC']);
  // Expected Count = column B in your upload file: "Location On Hand"
  headerIdx.expCount = pickHeaderIndex(headerRow, ['Location On Hand']);

  if (headerIdx.loc < 0) throw new Error('Missing header: Location');
  if (headerIdx.upc < 0) throw new Error('Missing header: upc');
  if (headerIdx.expCount < 0) console.warn('Missing header: Location On Hand');
}

function loadCurrentExpected() {
  const row = rows[1 + currentIdx];
  if (!row) return;

  state.expectedLocation = normalizeLocation(row[headerIdx.loc]);
  state.expectedUPC = normalizeUPC(row[headerIdx.upc]);
  state.expectedCount = (headerIdx.expCount >= 0) ? String(row[headerIdx.expCount] ?? '') : '';

  state.scannedLocation = '';
  state.scannedUPC = '';
  state.actualCount = null;

  ui.lastScanText.textContent = '—';
  setRowPill();
  state.rowScanStart = new Date();
}

async function postToSheet(payload) {
  const res = await fetch(API_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
    body: JSON.stringify(payload)
  });
  const text = await res.text();
  try { return JSON.parse(text); } catch { return { raw:text }; }
}

async function fetchQueue() {
  const res = await fetch(API_URL + '?action=get_queue', { method:'GET' });
  const json = await res.json();
  if (json.result !== 'success') throw new Error(json.error || 'Queue fetch failed');
  return json.queue || [];
}

function buildRowsFromQueue(queue) {
  rows = [['Location','upc','Location On Hand']];
  queue.forEach(q => {
    rows.push([q.location, q.expected_upc, '']); // expected count unknown for queue items
  });
  initHeaderIndexes();
  currentIdx = 0;
  state.counts = { done:0, correct:0, incorrect:0, empty:0 };
  updateProgressUI();
  setRowPill();
  setPill(ui.statusPill, 'Queue loaded ✅', 'ok');
  ui.bigPrompt.textContent = 'Press Start to begin';
}

function handleScanComplete(rawValue) {
  if (!state.started) return;

  if (step === 'location') {
    const scanned = normalizeLocation(rawValue);
    state.scannedLocation = scanned;
    ui.lastScanText.textContent = scanned || '(empty)';

    const ok = scanned && scanned === state.expectedLocation;
    if (ok) {
      beep(true);
      setPill(ui.statusPill, 'Location OK ✅', 'ok');
      setTimeout(() => setStep('upc'), 40);
    } else {
      beep(false);
      setPill(ui.statusPill, 'Location mismatch ❌', 'bad');
    }
    return;
  }

  if (step === 'upc') {
    const scannedUPC = normalizeUPC(rawValue);
    state.scannedUPC = scannedUPC;
    ui.lastScanText.textContent = scannedUPC || '(empty)';

    let upcStatus = 'Empty';
    if (!scannedUPC) upcStatus = 'Empty';
    else if (scannedUPC === state.expectedUPC) upcStatus = 'Correct';
    else upcStatus = 'Incorrect';

    if (state.mode === 'verification') {
      finalizeAndPost(upcStatus).catch(err => alert(err.message || String(err)));
      return;
    }

    setStep('count');
    openCountModal();
    return;
  }
}

async function finalizeAndPost(upcStatus) {
  const end = new Date();
  const start = state.rowScanStart || end;
  const durationSec = Math.max(0, Math.round((end - start) / 1000));

  const payload = {
    timestamp: new Date().toISOString(),
    employee_name: state.employee,
    verification_mode: state.mode, // 'verification' or 'count'

    location: state.expectedLocation,
    expected_upc: state.expectedUPC,
    scanned_upc: state.scannedUPC,
    upc_status: upcStatus,

    expected_count: state.expectedCount,                 // blind
    actual_count: (state.mode === 'count') ? String(state.actualCount ?? '') : '',
    count_status: '',

    scan_start_time: start.toISOString(),
    scan_end_time: end.toISOString(),
    scan_duration_seconds: durationSec,

    step: currentIdx + 1,
    total_steps: totalSteps()
  };

  const resp = await postToSheet(payload);
  state.lastPosted = resp;

  state.counts.done++;
  if (upcStatus === 'Correct') state.counts.correct++;
  else if (upcStatus === 'Incorrect') state.counts.incorrect++;
  else state.counts.empty++;

  updateProgressUI();
  beep(upcStatus === 'Correct');
  nextRowOrDone();
}

function nextRowOrDone() {
  currentIdx++;
  if (currentIdx >= totalSteps()) {
    setStep('done');
    return;
  }
  loadCurrentExpected();
  setStep('location');
}

function startRun() {
  const name = ui.employeeName.value.trim();
  if (!name) { alert('Enter your name first.'); return; }
  if (!rows.length) { alert('Load queue or upload a file first.'); return; }

  state.employee = name;
  state.mode = ui.mode.value;
  state.started = true;

  currentIdx = 0;
  state.counts = { done:0, correct:0, incorrect:0, empty:0 };
  updateProgressUI();

  loadCurrentExpected();
  setStep('location');
}

function resetAll() {
  rows = [];
  currentIdx = 0;
  headerIdx = { loc:-1, upc:-1, expCount:-1 };
  scanBuffer = '';
  lastKeyTime = 0;

  state.started = false;
  state.mode = 'verification';
  state.employee = '';
  state.expectedLocation = '';
  state.expectedUPC = '';
  state.expectedCount = '';
  state.scannedLocation = '';
  state.scannedUPC = '';
  state.actualCount = null;
  state.rowScanStart = null;
  state.counts = { done:0, correct:0, incorrect:0, empty:0 };
  state.lastPosted = null;

  ui.fileInput.value = '';
  ui.lastScanText.textContent = '—';
  ui.bufferText.textContent = '—';
  updateProgressUI();
  setRowPill();
  setStep('upload');
  setPill(ui.statusPill, 'Not started', '');
}

function readFile(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onerror = () => reject(reader.error);
    reader.onload = () => resolve(reader.result);
    reader.readAsArrayBuffer(file);
  });
}

async function loadWorkbookFromFile(file) {
  const buf = await readFile(file);
  const wb = XLSX.read(buf, { type: 'array' });
  const name = wb.SheetNames[0];
  const ws = wb.Sheets[name];
  rows = XLSX.utils.sheet_to_json(ws, { header: 1, raw: true, defval: '' });

  if (!rows.length) throw new Error('Sheet is empty.');
  initHeaderIndexes();
  if (rows.length < 2) throw new Error('No data rows found.');

  currentIdx = 0;
  state.counts = { done:0, correct:0, incorrect:0, empty:0 };
  updateProgressUI();
  setRowPill();

  setPill(ui.statusPill, 'File loaded ✅', 'ok');
  ui.bigPrompt.textContent = 'Press Start to begin';
}

/* Scanner buffering: finalize only on Enter */
document.addEventListener('keydown', (e) => {
  if (!state.started) return;
  if (!['location','upc'].includes(step)) return;

  const now = performance.now();
  if (now - lastKeyTime > SCAN_TIMEOUT_MS) scanBuffer = '';
  lastKeyTime = now;

  if (e.key === 'Enter') {
    e.preventDefault();
    const payload = scanBuffer;
    scanBuffer = '';
    ui.bufferText.textContent = '—';
    if (payload) handleScanComplete(payload);
    return;
  }

  if (e.key.length !== 1) return;
  scanBuffer += e.key;
  ui.bufferText.textContent = scanBuffer;
});

ui.scanBox.addEventListener('click', () => {
  ui.scanBox.classList.add('active');
  setTimeout(() => ui.scanBox.classList.remove('active'), 250);
});

/* Mode UI */
ui.mode.addEventListener('change', () => {
  ui.countSourceWrap.style.display = (ui.mode.value === 'count') ? 'block' : 'none';
});

/* Upload handler */
ui.fileInput.addEventListener('change', async () => {
  const file = ui.fileInput.files?.[0];
  if (!file) return;

  if (ui.mode.value === 'count' && ui.countSource.value === 'queue') {
    alert('You selected Queue for count. Use "Load Queue" instead of uploading a file.');
    ui.fileInput.value = '';
    return;
  }

  try {
    await loadWorkbookFromFile(file);
  } catch (err) {
    alert(err.message || String(err));
    resetAll();
  }
});

/* Start */
ui.startBtn.addEventListener('click', () => {
  if (ui.mode.value === 'count' && ui.countSource.value === 'queue') {
    if (!rows.length) { alert('Click "Load Queue" first.'); return; }
  } else {
    if (!rows.length) { alert('Upload the Excel file first.'); return; }
  }
  startRun();
});

/* Submit (count mode only) */
ui.submitBtn.addEventListener('click', async () => {
  if (ui.mode.value !== 'count') return;
  if (step !== 'count') return;

  const upcStatus = (!state.scannedUPC) ? 'Empty'
                 : (state.scannedUPC === state.expectedUPC) ? 'Correct'
                 : 'Incorrect';

  ui.submitBtn.disabled = true;
  try {
    await finalizeAndPost(upcStatus);
  } catch (err) {
    alert(err.message || String(err));
    ui.submitBtn.disabled = false;
  }
});

/* Reset */
ui.resetBtn.addEventListener('click', resetAll);

/* Queue load */
ui.loadQueueBtn.addEventListener('click', async () => {
  try {
    const queue = await fetchQueue();
    if (!queue.length) { alert('Queue is empty ✅'); return; }
    buildRowsFromQueue(queue);
  } catch (err) {
    alert(err.message || String(err));
  }
});

/* Calculator modal */
let countEntry = '';

function openCountModal() {
  countEntry = '';
  ui.countDisplay.textContent = '0';
  ui.modalBackdrop.classList.add('show');
  ui.modalBackdrop.setAttribute('aria-hidden', 'false');
}

function closeCountModal() {
  ui.modalBackdrop.classList.remove('show');
  ui.modalBackdrop.setAttribute('aria-hidden', 'true');
}

function acceptCountAndEnableSubmit() {
  const val = countEntry ? parseInt(countEntry, 10) : 0;
  state.actualCount = Number.isFinite(val) ? val : 0;
  closeCountModal();

  setPill(ui.statusPill, `Count entered: ${state.actualCount}`, '');
  ui.submitBtn.disabled = false;
}

ui.modalBackdrop.addEventListener('click', (e) => {
  if (e.target === ui.modalBackdrop) {
    state.actualCount = 0;
    closeCountModal();
    setPill(ui.statusPill, `Count entered: 0`, '');
    ui.submitBtn.disabled = false;
  }
});

document.querySelectorAll('.key').forEach(btn => {
  btn.addEventListener('click', () => {
    const k = btn.getAttribute('data-k');
    if (k === 'cancel') {
      state.actualCount = 0;
      closeCountModal();
      setPill(ui.statusPill, `Count entered: 0`, '');
      ui.submitBtn.disabled = false;
      return;
    }
    if (k === 'clear') {
      countEntry = '';
      ui.countDisplay.textContent = '0';
      return;
    }
    if (k === 'del') {
      countEntry = countEntry.slice(0, -1);
      ui.countDisplay.textContent = countEntry || '0';
      return;
    }
    if (k === 'enter') {
      acceptCountAndEnableSubmit();
      return;
    }
    countEntry += k;
    ui.countDisplay.textContent = countEntry;
  });
});

/* Init */
resetAll();
</script>
</body>
</html>
